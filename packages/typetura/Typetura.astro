---
import Packages from './Packages.astro'
import type {PackageProps} from './types'
interface Props {
	base?: number;
	scale?: number;
	js?: boolean;
	selectors?: string | string[];
	pack?: PackageProps 
}

let { base = 20, scale = 1, js, selectors, pack } = Astro.props as Props;

let overrides: string[];
if (selectors && !js) {
	throw Error("prop.js needs to be appended to the `<Typetura/>` component inorder to adjust Typetura's default selectors");
}
if (selectors) {
	if (typeof selectors === 'string') {
		overrides = selectors.includes(',') ? selectors.split(',') : [selectors];
	}
	if (Array.isArray(selectors)) {
		overrides = selectors;
	}
}
const renderStatement = () => {
	if (js && overrides) {
		return `
			<script src="https://cdn.jsdelivr.net/gh/scottkellum/typetura.js@master/js/typetura.min.js"></script>
		<script>
		window.typetura={ base:${base},scale:${scale},selectors:[${overrides}]}</script>`;
	}
	if (js) {
		return `
			<script src="https://cdn.jsdelivr.net/gh/scottkellum/typetura.js@master/js/typetura.min.js"></script>
		<script>window.typetura={base:${base},scale:${scale}}</script>`;
	}
	return `
		<script src="https://cdn.jsdelivr.net/gh/scottkellum/typetura.js@master/js/typetura.min.js"></script>
	<style>
	:root{
		--tt-base:${base};
		--tt-scale:${scale};
	}
	</style>`;
};
---
{ Boolean(pack)
  ?
	<Packages pkg={pack}/>
	:
	<Fragment set:html={renderStatement()} />
}
